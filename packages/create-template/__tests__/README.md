# CreateTemplate 单元测试说明

## 测试文件
`packages/create-template/__tests__/create.spec.ts`

## 测试覆盖范围

### 1. 构造函数测试
- ✅ 正确初始化 CreateTemplate 实例
- ✅ 使用默认工作目录当未提供 cwd 时
- ✅ 处理部分选项

### 2. run 方法测试
- ✅ 成功运行项目创建流程
- ✅ 处理获取模板失败的情况

### 3. _getTemplate 私有方法测试

#### 场景选择测试
- ✅ 使用提供的有效场景
- ✅ 提示用户选择场景当未提供场景时
- ✅ 提示用户选择场景当提供无效场景时

#### 模板选择测试
- ✅ 使用提供的有效模板
- ✅ 提示用户选择模板当未提供模板时
- ✅ 提示用户选择模板当提供无效模板时

#### 断言验证测试
- ✅ 在场景答案为空时抛出错误
- ✅ 在直接提供空场景时抛出错误
- ✅ 在模板答案为空时抛出错误
- ✅ 在找不到对应配置时抛出错误

### 4. _formatTemplate 私有方法测试
- ✅ 正确格式化模板对象
- ✅ 处理空模板对象
- ✅ 处理单个模板

### 5. 集成测试
- ✅ 完整执行从配置到创建的流程
- ✅ 正确处理用户取消操作

### 6. 边界情况测试
- ✅ 处理空项目名称
- ✅ 处理特殊字符的项目名称
- ✅ 正确传递所有构造函数选项到 Create 实例

## 技术特点

### ESM 语法
- 使用 ES6 import/export 语法
- 支持动态导入和模块系统

### TypeScript 严格类型检查
- 禁止使用 `any` 类型
- 完全类型安全的测试代码
- 正确的泛型类型推断

### 依赖 Mock 策略
- Mock 了所有外部依赖：`@eljs/create`、`@eljs/utils`、`node:assert`、`../src/utils`
- 使用 Jest 的 mock 功能进行依赖隔离
- 每个测试用例前清理 mock 状态

### 中文注释和测试描述
- 所有测试用例使用中文描述
- 测试结构清晰，易于理解

## 代码质量
- ✅ 通过所有 ESLint 规则检查
- ✅ 符合项目的代码规范
- ✅ 包含 23 个测试用例，覆盖所有主要功能
- ✅ 测试执行时间约 2 秒

## Mock 策略说明

### 1. @eljs/create Mock
- Mock Create 类的构造函数和 run 方法
- 确保测试不依赖实际的文件系统操作

### 2. @eljs/utils Mock
- Mock prompts 函数，模拟用户交互
- 控制用户选择场景和模板的行为

### 3. node:assert Mock
- Mock assert 函数，控制断言行为
- 测试错误处理逻辑

### 4. ../src/utils Mock
- Mock objectToArray 和 onCancel 函数
- 隔离工具函数的实现细节

## 测试覆盖的关键逻辑

1. **配置验证**：测试场景和模板的有效性检查
2. **用户交互**：测试 prompts 的调用和响应处理
3. **错误处理**：测试各种错误情况的处理
4. **数据转换**：测试模板格式化逻辑
5. **集成流程**：测试完整的创建流程
6. **边界情况**：测试特殊输入和异常情况

这个测试文件确保了 `CreateTemplate` 类的所有功能都得到了充分的测试覆盖，具有高质量的代码规范和完整的错误处理验证。
